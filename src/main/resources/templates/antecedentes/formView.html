<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title th:text="${titulo}">Registrar Antecedente Médico</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { 
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); 
            font-family: "Inter", sans-serif; 
            color: #1565c0;
            min-height: 100vh;
        }
        .header { 
            background: linear-gradient(135deg, #1976d2, #42a5f5); 
            color: white; 
            padding: 1rem 0; 
            text-align: center; 
            box-shadow: 0 2px 6px rgba(25,118,210,0.1); 
        }
        .form-container { 
            background: #fff; 
            border-radius: 12px; 
            box-shadow: 0 2px 8px rgba(45,90,45,0.08); 
            padding: 30px; 
            max-width: 750px; 
            margin: 40px auto; 
            border: 2px solid #e8f5e8;
        }
        label { 
            font-weight: 600; 
            color: #1565c0; 
        }
        input, select, textarea { 
            border-radius: 8px; 
            border: 1px solid #e8f5e8; 
            padding: 0.5rem; 
        }
        input:focus, select:focus, textarea:focus {
            border-color: #42a5f5;
            box-shadow: 0 0 0 0.2rem rgba(66,165,245,0.25);
        }
        .btn-primary-custom { 
            background: linear-gradient(135deg, #1976d2, #42a5f5); 
            border: none; 
            transition: 0.3s; 
        }
        .btn-primary-custom:hover { 
            background: linear-gradient(135deg, #1565c0, #1976d2); 
        }
        .btn-secondary-custom { 
            background: linear-gradient(135deg, #90a4ae, #78909c); 
            border: none; 
            transition: 0.3s; 
        }
        .btn-secondary-custom:hover { 
            background: linear-gradient(135deg, #78909c, #607d8b); 
        }
        .footer { 
            text-align: center; 
            color: #1565c0; 
            margin-top: 2rem; 
            font-weight: 500;
        }
        .title-section { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 20px; 
        }
        .title-section h4 { 
            margin: 0; 
            font-weight: 700; 
            color: #1565c0; 
        }
        .divider { 
            border-top: 2px solid #e3f2fd; 
            margin: 20px 0; 
        }
    </style>
</head>

<body>

<div class="header">
    <h2 th:text="${titulo}">Gestión de Antecedentes Médicos</h2>
</div>

<div class="form-container">
    <div class="title-section">
        <h4>Registrar Antecedente</h4>
        <a th:if="${paciente != null}" th:href="@{'/antecedentes/paciente/' + ${paciente.idPaciente}}" class="btn btn-secondary-custom btn-sm">← Regresar</a>
        <a th:unless="${paciente != null}" th:href="@{/antecedentes}" class="btn btn-secondary-custom btn-sm">← Regresar</a>
    </div>
    <div class="divider"></div>

    <form th:action="${paciente != null ? '/antecedentes/guardar/paciente' : '/antecedentes/guardar'}" th:object="${antecedente}" method="post">

        <input type="hidden" th:field="*{idAntecedente}"/>
        <input th:if="${paciente != null}" type="hidden" name="pacienteId" th:value="${paciente.idPaciente}"/>

        <!-- Información del paciente (solo si viene de un paciente específico) -->
        <div th:if="${paciente != null}" class="mb-3">
            <label>Paciente</label>
            <input type="text" class="form-control" th:value="${paciente.nombres + ' ' + paciente.apellidos}" readonly>
        </div>

        <!-- Selección de historia clínica -->
        <div class="mb-3">
            <label for="historiaClinica">Historia Clínica (Opcional)</label>
            <select name="historiaClinicaId" class="form-select" id="historiaClinica">
                <option value="">Seleccione una historia clínica (opcional)</option>
                <option th:each="h : ${historias}"
                        th:value="${h.idHistoria}"
                        th:text="${h.fechaApertura}">
                </option>
            </select>
        </div>

        <!-- Tipo de antecedente -->
        <div class="mb-3">
            <label for="tipo">Tipo</label>
            <input type="text" th:field="*{tipo}" id="tipo" class="form-control"
                   placeholder="Ejemplo: Alergias, Cirugías, Enfermedades previas..." required>
        </div>

        <!-- Descripción -->
        <div class="mb-3">
            <label for="descripcion">Descripción</label>
            <textarea th:field="*{descripcion}" id="descripcion" class="form-control" rows="3"
                      placeholder="Ingrese los detalles del antecedente médico..." required></textarea>
        </div>

        <!-- Botones -->
        <div class="d-flex justify-content-end gap-2">
            <a th:href="@{/antecedentes}" class="btn btn-secondary-custom">Cancelar</a>
            <button type="submit" class="btn btn-primary-custom">Guardar</button>
        </div>
    </form>
</div>

<div class="footer">
    <p>Hospital Gestión © 2025 — Sistema de Antecedentes</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

